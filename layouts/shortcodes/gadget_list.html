<div class="gadget-wrap">
    <div class="gadget-header">
        <div class="g-stat">
            <span class="g-label">Total Assets</span>
            <span id="g-total-price" class="g-value">￥0</span>
        </div>
        <div class="g-stat">
            <span class="g-label">Daily Cost (Avg)</span>
            <span id="g-total-daily" class="g-value">￥0</span>
        </div>
    </div>

    <div class="g-controls">
        <button id="g-order-toggle" class="g-order-btn" title="切换升降序">
            <svg id="sort-icon-desc" viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <polyline points="19 12 12 19 5 12"></polyline>
            </svg>
            <svg id="sort-icon-asc" viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="19" x2="12" y2="5"></line>
                <polyline points="5 12 12 5 19 12"></polyline>
            </svg>
        </button>
        
        <span class="g-control-label">SORT BY:</span>
        <div class="g-btn-group">
            <button class="g-sort-btn active" data-sort="progress">回本进度</button>
            <button class="g-sort-btn" data-sort="price">购买价格</button>
            <button class="g-sort-btn" data-sort="daily">日均成本</button>
            <button class="g-sort-btn" data-sort="date">购买日期</button>
        </div>
    </div>

    <div id="gadget-container" class="gadget-grid"></div>
</div>

<style>
    /* 基础容器 */
    .gadget-wrap { margin: 2.5rem 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; }
    
    /* 头部卡片 - 毛玻璃效果 */
    .gadget-header { 
        display: flex; gap: 40px; margin-bottom: 25px; 
        padding: 28px; background: var(--entry); 
        border-radius: 24px; border: 1px solid var(--border);
        box-shadow: 0 4px 15px rgba(0,0,0,0.02);
    }
    .g-stat { display: flex; flex-direction: column; }
    .g-label { font-size: 0.65rem; color: var(--secondary); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 6px; font-weight: 600; opacity: 0.8; }
    .g-value { font-size: 1.6rem; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums; }

    /* 控制栏 */
    .g-controls { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding: 0 5px; }
    .g-control-label { font-size: 0.7rem; font-weight: 800; color: var(--secondary); opacity: 0.4; letter-spacing: 0.5px; }
    .g-btn-group { display: flex; gap: 8px; }

    /* 方形排序切换按钮 - 带果味动画 */
    .g-order-btn {
        width: 38px; height: 38px;
        display: flex; align-items: center; justify-content: center;
        background: var(--entry); border: 1px solid var(--border);
        color: var(--primary); border-radius: 12px; cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        padding: 0; position: relative; overflow: hidden;
    }
    .g-order-btn svg {
        position: absolute;
        transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
    }
    #sort-icon-asc { transform: rotate(-180deg); opacity: 0; }
    .g-order-btn.is-asc #sort-icon-desc { transform: rotate(180deg); opacity: 0; }
    .g-order-btn.is-asc #sort-icon-asc { transform: rotate(0deg); opacity: 1; }
    .g-order-btn:hover { background: var(--tertiary); }
    .g-order-btn:active { transform: scale(0.9); }

    /* 维度排序按钮 */
    .g-sort-btn { 
        background: transparent; border: none; color: var(--secondary); 
        font-size: 0.85rem; cursor: pointer; padding: 6px 14px; 
        border-radius: 10px; transition: all 0.2s ease; font-weight: 500;
    }
    .g-sort-btn.active { background: var(--primary); color: var(--theme); font-weight: 600; }

    /* 瀑布流卡片 */
    .gadget-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 18px; }
    .g-card { 
        background: var(--entry); border: 1px solid var(--border); 
        padding: 24px; border-radius: 24px; position: relative;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex; flex-direction: column;
    }
    .g-card:hover { transform: translateY(-6px); box-shadow: 0 15px 35px rgba(0,0,0,0.08); border-color: var(--tertiary); }
    
    .g-name { font-size: 1.15rem; font-weight: 700; margin-bottom: 6px; color: var(--primary); padding-right: 30px;}
    .g-info { font-size: 0.75rem; color: var(--secondary); margin-bottom: 20px; font-weight: 400; }

    /* 进度条 */
    .g-progress-wrap { margin-bottom: 20px; }
    .g-progress-text { display: flex; justify-content: space-between; font-size: 0.68rem; margin-bottom: 8px; font-weight: 700; letter-spacing: 0.3px; }
    .g-progress-bar { width: 100%; height: 6px; background: var(--border); border-radius: 10px; overflow: hidden; }
    .g-progress-fill { height: 100%; background: #007AFF; border-radius: 10px; transition: width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .g-progress-fill.completed { background: #D4AF37; } /* 已回本显示金属金 */

    /* 底部成本 */
    .g-cost-box { border-top: 1px solid var(--border); padding-top: 18px; margin-top: auto; }
    .g-day-val { font-size: 1.8rem; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums; }
    .g-unit { font-size: 0.85rem; color: var(--secondary); margin-left: 3px; font-weight: 600; }
    .g-price-tag { position: absolute; top: 26px; right: 26px; font-size: 0.7rem; font-weight: 700; opacity: 0.25; }

    /* 移动端适配 */
    @media (max-width: 640px) {
        .gadget-header { gap: 1.5rem; flex-direction: column; }
        .gadget-grid { grid-template-columns: 1fr; }
        .g-controls { overflow-x: auto; white-space: nowrap; padding-bottom: 10px; }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const RECOVERY_DAYS = 1095; // 回本基准天数（3年）
    let currentOrder = 'desc'; 
    let currentSortType = 'progress';

    const rawData = [
        {{- range $.Page.Params.gadgets }}
        { name: "{{ .name }}", date: "{{ .date }}", price: {{ .price }} },
        {{- end }}
    ];

    // 预处理数据，计算核心指标
    const processedData = rawData.map(item => {
        const days = Math.max(1, Math.floor((new Date() - new Date(item.date)) / 86400000));
        const daily = parseFloat((item.price / days).toFixed(2));
        const progress = Math.min(100, Math.floor((days / RECOVERY_DAYS) * 100));
        return { ...item, days, daily, progress, timestamp: new Date(item.date).getTime() };
    });

    const container = document.getElementById('gadget-container');
    const sortBtns = document.querySelectorAll('.g-sort-btn');
    const orderToggle = document.getElementById('g-order-toggle');

    function render() {
        // 排序逻辑
        let sorted = [...processedData].sort((a, b) => {
            let valA, valB;
            switch(currentSortType) {
                case 'progress': valA = a.progress; valB = b.progress; break;
                case 'price': valA = a.price; valB = b.price; break;
                case 'daily': valA = a.daily; valB = b.daily; break;
                case 'date': valA = a.timestamp; valB = b.timestamp; break;
            }
            return currentOrder === 'desc' ? valB - valA : valA - valB;
        });

        container.innerHTML = '';
        let totalPrice = 0;
        let totalDaily = 0;

        sorted.forEach(item => {
            totalPrice += item.price;
            totalDaily += item.daily;

            const el = document.createElement('div');
            el.className = 'g-card';
            const isCompleted = item.progress >= 100;
            
            el.innerHTML = `
                <div class="g-price-tag">￥${item.price.toLocaleString()}</div>
                <div class="g-name">${item.name}</div>
                <div class="g-info">In Service: ${item.days} days / Since ${item.date}</div>
                
                <div class="g-progress-wrap">
                    <div class="g-progress-text">
                        <span style="color:${isCompleted ? '#D4AF37' : 'inherit'}">${isCompleted ? 'FULLY RECOVERED' : 'RECOVERY PROGRESS'}</span>
                        <span style="color:${isCompleted ? '#D4AF37' : 'inherit'}">${item.progress}%</span>
                    </div>
                    <div class="g-progress-bar">
                        <div class="g-progress-fill ${isCompleted ? 'completed' : ''}" style="width: ${item.progress}%"></div>
                    </div>
                </div>

                <div class="g-cost-box">
                    <span class="g-day-val">￥${item.daily}</span><span class="g-unit">/ Day</span>
                </div>
            `;
            container.appendChild(el);
        });

        document.getElementById('g-total-price').innerText = '￥' + totalPrice.toLocaleString();
        document.getElementById('g-total-daily').innerText = '￥' + totalDaily.toFixed(2);
    }

    // 切换排序维度
    sortBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            sortBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentSortType = btn.dataset.sort;
            render();
        });
    });

    // 切换升降序及图标动画
    orderToggle.addEventListener('click', () => {
        currentOrder = currentOrder === 'desc' ? 'asc' : 'desc';
        orderToggle.classList.toggle('is-asc');
        render();
    });

    render(); // 初始渲染
});
</script>